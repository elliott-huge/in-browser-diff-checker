<!DOCTYPE html>
<html>
<head>
    <title>Text Diff Viewer</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        textarea {
            height: 200px;
            padding: 8px;
            margin: 8px 0;
            font-family: monospace;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        button:hover {
            background: #0052a3;
        }
        
        #diff-output {
            font-family: monospace;
            white-space: pre;
            border: 1px solid #ddd;
            padding: 20px;
            overflow-x: auto;
        }
        
        .diff-line {
            display: flex;
            align-items: flex-start;
            padding: 2px 0;
        }
        
        .line-number {
            width: 50px;
            text-align: right;
            padding-right: 10px;
            color: #666;
            user-select: none;
        }
        
        .line-content {
            flex: 1;
            padding-left: 10px;
        }
        
        .deletion {
            background-color: #ffeef0;
        }
        
        .deletion .line-content {
            color: #b31d28;
        }
        
        .addition {
            background-color: #e6ffec;
        }
        
        .addition .line-content {
            color: #22863a;
        }

        #status {
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-grid">
            <div class="input-group">
                <label>Original Text:</label>
                <textarea id="original-text" placeholder="Enter original text...">Hello World</textarea>
            </div>
            <div class="input-group">
                <label>New Text:</label>
                <textarea id="new-text" placeholder="Enter new text...">Hello New World</textarea>
            </div>
        </div>
        <div id="status">Loading diff library...</div>
        <button onclick="computeDiff()">Compare Texts</button>
        <div id="diff-output"></div>
    </div>

    <script>
        // Initialize status tracking
        let dmpLoaded = false;
        const statusDiv = document.getElementById('status');
        
        // Load diff-match-patch library
        const scriptElement = document.createElement('script');
        scriptElement.src = 'https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js';
        scriptElement.onload = () => {
            dmpLoaded = true;
            statusDiv.textContent = 'Diff library loaded - ready to compare';
            statusDiv.style.color = '#22863a';
        };
        scriptElement.onerror = () => {
            statusDiv.textContent = 'Error loading diff library!';
            statusDiv.style.color = '#b31d28';
        };
        document.head.appendChild(scriptElement);

        function computeDiff() {
            console.log('computeDiff called');
            
            if (!dmpLoaded) {
                alert('Please wait for the diff library to load');
                return;
            }

            const originalText = document.getElementById('original-text').value;
            const newText = document.getElementById('new-text').value;
            const diffOutput = document.getElementById('diff-output');
            
            console.log('Original text:', originalText);
            console.log('New text:', newText);
            
            try {
                // Create diff_match_patch object
                const dmp = new diff_match_patch();
                const diff = dmp.diff_main(originalText, newText);
                dmp.diff_cleanupSemantic(diff);
                
                console.log('Generated diff:', diff);
                
                // Clear previous output
                diffOutput.innerHTML = '';
                
                let oldLineNumber = 1;
                let newLineNumber = 1;
                
                // Process the diff
                diff.forEach(([type, text]) => {
                    const lines = text.split('\n');
                    
                    lines.forEach((line, lineIndex) => {
                        // Skip empty last line
                        if (lineIndex === lines.length - 1 && line === '') return;
                        
                        const diffLine = document.createElement('div');
                        diffLine.className = 'diff-line';
                        
                        const oldNum = document.createElement('div');
                        oldNum.className = 'line-number';
                        
                        const newNum = document.createElement('div');
                        newNum.className = 'line-number';
                        
                        const content = document.createElement('div');
                        content.className = 'line-content';
                        
                        if (type === 0) { // Equal
                            oldNum.textContent = oldLineNumber++;
                            newNum.textContent = newLineNumber++;
                            content.textContent = line;
                        } else if (type === -1) { // Deletion
                            diffLine.classList.add('deletion');
                            oldNum.textContent = oldLineNumber++;
                            newNum.textContent = '-';
                            content.textContent = '-' + line;
                        } else if (type === 1) { // Addition
                            diffLine.classList.add('addition');
                            oldNum.textContent = '-';
                            newNum.textContent = newLineNumber++;
                            content.textContent = '+' + line;
                        }
                        
                        diffLine.appendChild(oldNum);
                        diffLine.appendChild(newNum);
                        diffLine.appendChild(content);
                        diffOutput.appendChild(diffLine);
                    });
                });
                
                console.log('Diff display complete');
            } catch (error) {
                console.error('Error computing diff:', error);
                diffOutput.innerHTML = '<div style="color: red;">Error computing diff: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
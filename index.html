<!DOCTYPE html>
<html>
<head>
    <title>Text Diff Viewer</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        textarea {
            height: 200px;
            padding: 8px;
            margin: 8px 0;
            font-family: monospace;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        button:hover {
            background: #0052a3;
        }
        
        #diff-output {
            font-family: monospace;
            white-space: pre-wrap;
            border: 1px solid #ddd;
            padding: 20px;
            overflow-x: auto;
        }
        
        .diff-line {
            display: flex;
            align-items: flex-start;
            padding: 2px 0;
        }
        
        .line-number {
            width: 50px;
            text-align: right;
            padding-right: 10px;
            color: #666;
            user-select: none;
        }
        
        .line-content {
            flex: 1;
            padding-left: 10px;
        }
        
        .deletion {
            background-color: #ffeef0;
        }
        
        .deletion .line-content {
            color: #b31d28;
        }
        
        .addition {
            background-color: #e6ffec;
        }
        
        .addition .line-content {
            color: #22863a;
        }

        .inline-deletion {
            background-color: #ffeef0;
            color: #b31d28;
            text-decoration: line-through;
        }

        .inline-addition {
            background-color: #e6ffec;
            color: #22863a;
        }

        #status {
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-grid">
            <div class="input-group">
                <label>Original Text:</label>
                <textarea id="original-text" placeholder="Enter original text...">Hello World</textarea>
            </div>
            <div class="input-group">
                <label>New Text:</label>
                <textarea id="new-text" placeholder="Enter new text...">Hello New World</textarea>
            </div>
        </div>
        <div id="status">Loading diff library...</div>
        <button onclick="computeDiff()">Compare Texts</button>
        <div id="diff-output"></div>
    </div>

    <script>
        let dmpLoaded = false;
        const statusDiv = document.getElementById('status');
        
        const scriptElement = document.createElement('script');
        scriptElement.src = 'https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js';
        scriptElement.onload = () => {
            dmpLoaded = true;
            statusDiv.textContent = 'Diff library loaded - ready to compare';
            statusDiv.style.color = '#22863a';
        };
        scriptElement.onerror = () => {
            statusDiv.textContent = 'Error loading diff library!';
            statusDiv.style.color = '#b31d28';
        };
        document.head.appendChild(scriptElement);

        function groupDiffsByLine(diff) {
            const lines = [];
            let currentLine = [];
            let currentText = '';
            
            diff.forEach(([type, text]) => {
                const textLines = text.split('\n');
                textLines.forEach((line, i) => {
                    if (i > 0) {
                        lines.push({
                            parts: currentLine,
                            text: currentText
                        });
                        currentLine = [];
                        currentText = '';
                    }
                    if (line.length > 0) {
                        currentLine.push([type, line]);
                        currentText += line;
                    }
                });
            });
            
            if (currentLine.length > 0) {
                lines.push({
                    parts: currentLine,
                    text: currentText
                });
            }
            
            return lines;
        }

        function computeDiff() {
            if (!dmpLoaded) {
                alert('Please wait for the diff library to load');
                return;
            }

            const originalText = document.getElementById('original-text').value;
            const newText = document.getElementById('new-text').value;
            const diffOutput = document.getElementById('diff-output');
            
            try {
                const dmp = new diff_match_patch();
                const diff = dmp.diff_main(originalText, newText);
                dmp.diff_cleanupSemantic(diff);
                
                diffOutput.innerHTML = '';
                
                const lines = groupDiffsByLine(diff);
                let oldLineNumber = 1;
                let newLineNumber = 1;
                
                lines.forEach(line => {
                    const diffLine = document.createElement('div');
                    diffLine.className = 'diff-line';
                    
                    const oldNum = document.createElement('div');
                    oldNum.className = 'line-number';
                    
                    const newNum = document.createElement('div');
                    newNum.className = 'line-number';
                    
                    const content = document.createElement('div');
                    content.className = 'line-content';
                    
                    // Determine line type
                    const hasAddition = line.parts.some(([type]) => type === 1);
                    const hasDeletion = line.parts.some(([type]) => type === -1);
                    const hasEqual = line.parts.some(([type]) => type === 0);
                    
                    if (hasEqual && !hasAddition && !hasDeletion) {
                        // Unchanged line
                        oldNum.textContent = oldLineNumber++;
                        newNum.textContent = newLineNumber++;
                        content.textContent = line.text;
                    } else if (hasAddition && !hasDeletion) {
                        // Pure addition
                        diffLine.classList.add('addition');
                        oldNum.textContent = '-';
                        newNum.textContent = newLineNumber++;
                        content.textContent = '+' + line.text;
                    } else if (hasDeletion && !hasAddition) {
                        // Pure deletion
                        diffLine.classList.add('deletion');
                        oldNum.textContent = oldLineNumber++;
                        newNum.textContent = '-';
                        content.textContent = '-' + line.text;
                    } else {
                        // Mixed changes - show inline diff
                        oldNum.textContent = oldLineNumber++;
                        newNum.textContent = newLineNumber++;
                        
                        line.parts.forEach(([type, text]) => {
                            const span = document.createElement('span');
                            span.textContent = text;
                            if (type === -1) {
                                span.className = 'inline-deletion';
                            } else if (type === 1) {
                                span.className = 'inline-addition';
                            }
                            content.appendChild(span);
                        });
                    }
                    
                    diffLine.appendChild(oldNum);
                    diffLine.appendChild(newNum);
                    diffLine.appendChild(content);
                    diffOutput.appendChild(diffLine);
                });
            } catch (error) {
                console.error('Error computing diff:', error);
                diffOutput.innerHTML = '<div style="color: red;">Error computing diff: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>